{"version":3,"sources":["js\\app.js"],"names":["Tile","options","element","document","createElement","value","position","x","y","isJoined","prototype","move","newPosition","render","top","left","style","cssText","className","Game","bestScore","localStorage","getItem","gameScore","playfield","getElementById","gameover","currentScoreEl","bestScoreEl","NewGame","tileList","Array","__randomTile","randomPos","Math","floor","random","undefined","appendChild","__removeTile","tile","removeChild","__moveAndJoin","isCoordinateInRange","coordinate","offset","__moveTile","dx","dy","newPos","reward","moveTiles","direction","score","isMoved","column","row","checkGameOver","zIndex","isGameOver","curentTile","rightTile","bottomTile","reset","self","filter","Boolean","forEach","textContent","setItem","Mouse","downX","downY","upX","upY","getDirection","abs","onMouseDown","event","pageX","pageY","onMouseUp","window","onload","resetBtn","game","mouse","addEventListener","e","which","touchEvent","touches","changedTouches"],"mappings":"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","file":"44c61d243a08768a576af7a939ca3246.map","sourcesContent":["function Tile (options) {\n  this.element = document.createElement('div');\n  this.value = options.value;\n  this.position = {\n    x: options.position.x,\n    y: options.position.y\n  };\n  this.isJoined = false;\n}\nTile.prototype.move = function (newPosition) {\n  this.position.x = newPosition.x;\n  this.position.y = newPosition.y;\n};\nTile.prototype.render = function () {\n  const top = this.position.y * 100 + this.position.y * 5;\n  const left = this.position.x * 100 + this.position.x * 5;\n  this.element.style.cssText = 'top: ' + top + 'px; left: ' + left + 'px;';\n  this.element.className = 'fade thing t' + this.value;\n  this.isJoined = false;\n  return this.element;\n};\n\nconst Game = (function () {\n  let bestScore = localStorage.getItem('bestScore') || 0;\n\n  let gameScore = 0;\n\n  const playfield = document.getElementById('playfield');\n  const gameover = document.getElementById('gameover');\n  const currentScoreEl = document.getElementById('currentscore');\n  const bestScoreEl = document.getElementById('bestscore');\n\n  const NewGame = function () {\n    this.tileList = [\n      new Array(4),\n      new Array(4),\n      new Array(4),\n      new Array(4)\n    ];\n  };\n\n  NewGame.prototype.__randomTile = function () {\n    let randomPos = {\n      x: Math.floor(Math.random() * 4),\n      y: Math.floor(Math.random() * 4)\n    };\n\n    while (this.tileList[randomPos.x][randomPos.y] !== undefined) {\n      randomPos = {\n        x: Math.floor(Math.random() * 4),\n        y: Math.floor(Math.random() * 4)\n      };\n    }\n\n    this.tileList[randomPos.x][randomPos.y] = new Tile({\n      value: Math.random() * 10 > 9 ? 4 : 2,\n      position: randomPos\n    });\n    playfield.appendChild(this.tileList[randomPos.x][randomPos.y].element);\n  };\n\n  NewGame.prototype.__removeTile = function (tile) {\n    this.tileList[tile.position.x][tile.position.y] = undefined;\n    playfield.removeChild(tile.element);\n  };\n  NewGame.prototype.__moveAndJoin = function (tile, position) {\n    tile.value *= 2;\n    tile.isJoined = true;\n    this.__removeTile(this.tileList[position.x][position.y]);\n    this.tileList[position.x][position.y] = tile;\n    return tile.value;\n  };\n  function isCoordinateInRange (coordinate, offset) {\n    return (offset < 0 && coordinate === 0) || (offset > 0 && coordinate === 3);\n  }\n  NewGame.prototype.__moveTile = function (tile, dx, dy) {\n    if (!tile) return -1;\n    if (isCoordinateInRange(tile.position.x, dx)) return -1;\n    if (isCoordinateInRange(tile.position.y, dy)) return -1;\n\n    const newPos = {\n      x: tile.position.x,\n      y: tile.position.y\n    };\n    let reward = 0;\n\n    do {\n      if (isCoordinateInRange(newPos.x, dx)) break;\n      if (isCoordinateInRange(newPos.y, dy)) break;\n\n      newPos.x = newPos.x + dx;\n      newPos.y = newPos.y + dy;\n    } while (this.tileList[newPos.x][newPos.y] === undefined);\n\n    if (this.tileList[newPos.x][newPos.y] === undefined) {\n      this.tileList[newPos.x][newPos.y] = tile;\n    } else if (!this.tileList[newPos.x][newPos.y].isJoined && this.tileList[newPos.x][newPos.y].value === tile.value) {\n      reward = this.__moveAndJoin(tile, newPos);\n    } else if (this.tileList[newPos.x - dx][newPos.y - dy] === undefined) {\n      newPos.x = newPos.x - dx;\n      newPos.y = newPos.y - dy;\n      this.tileList[newPos.x][newPos.y] = tile;\n    } else {\n      return -1;\n    }\n\n    this.tileList[tile.position.x][tile.position.y] = undefined;\n    tile.move(newPos);\n\n    return reward;\n  };\n  NewGame.prototype.moveTiles = function (direction) {\n    let score = 0;\n    let isMoved = false;\n\n    for (let column = 0; column < 4; column++) {\n      for (let row = 0; row < 4; row++) {\n        switch (direction) {\n          case 'left':\n            score = this.__moveTile(this.tileList[column][row], -1, 0);\n            break;\n          case 'right':\n            score = this.__moveTile(this.tileList[3 - column][row], 1, 0);\n            break;\n          case 'up':\n            score = this.__moveTile(this.tileList[column][row], 0, -1);\n            break;\n          case 'down':\n            score = this.__moveTile(this.tileList[column][3 - row], 0, 1);\n            break;\n          default: return;\n        }\n\n        if (score !== -1) {\n          gameScore += score;\n          isMoved = true;\n        }\n      }\n    }\n\n    if (isMoved) {\n      this.__randomTile();\n      if (this.checkGameOver()) gameover.style.zIndex = '100';\n    }\n  };\n\n  NewGame.prototype.checkGameOver = function () {\n    let isGameOver = false;\n    for (let column = 0; column < 4; column++) {\n      for (let row = 0; row < 4; row++) {\n        const curentTile = this.tileList[column][row];\n        const rightTile = column < 3 ? this.tileList[column + 1][row] : undefined;\n        const bottomTile = row < 3 ? this.tileList[column][row + 1] : undefined;\n\n        if (curentTile === undefined) {\n          return false;\n        }\n\n        if (bottomTile && curentTile.value === bottomTile.value) {\n          return false;\n        }\n\n        if (rightTile && curentTile.value === rightTile.value) {\n          return false;\n        }\n\n        isGameOver = true;\n      }\n    }\n    return isGameOver;\n  };\n\n  NewGame.prototype.reset = function () {\n    const self = this;\n    this.tileList.filter(Boolean).forEach(function (column) {\n      column.filter(Boolean).forEach(function (tile) {\n        self.__removeTile(tile);\n      });\n    });\n    gameover.style.zIndex = '-1';\n    gameScore = 0;\n    this.__randomTile();\n    this.render();\n  };\n\n  NewGame.prototype.render = function () {\n    bestScore = gameScore > bestScore ? gameScore : bestScore;\n    currentScoreEl.textContent = gameScore;\n    bestScoreEl.textContent = bestScore;\n    localStorage.setItem('bestScore', bestScore);\n\n    this.tileList.filter(Boolean).forEach(function (column) {\n      column.filter(Boolean).forEach(function (tile) {\n        tile.render();\n      });\n    });\n  };\n\n  return NewGame;\n})();\n\nfunction Mouse () {\n  this.downX = undefined;\n  this.downY = undefined;\n  this.upX = undefined;\n  this.upY = undefined;\n}\nMouse.prototype.getDirection = function () {\n  let direction = '';\n\n  if (this.upX < this.downX && Math.abs(this.upX - this.downX) > Math.abs(this.upY - this.downY)) {\n    direction = 'left';\n  }\n  if (this.upX > this.downX && Math.abs(this.upX - this.downX) > Math.abs(this.upY - this.downY)) {\n    direction = 'right';\n  }\n  if (this.upY < this.downY && Math.abs(this.upX - this.downX) < Math.abs(this.upY - this.downY)) {\n    direction = 'up';\n  }\n  if (this.upY > this.downY && Math.abs(this.upX - this.downX) < Math.abs(this.upY - this.downY)) {\n    direction = 'down';\n  }\n\n  return direction;\n};\nMouse.prototype.onMouseDown = function (event) {\n  this.downX = event.pageX;\n  this.downY = event.pageY;\n};\nMouse.prototype.onMouseUp = function (event) {\n  this.upX = event.pageX;\n  this.upY = event.pageY;\n};\nMouse.prototype.reset = function () {\n  this.downX = undefined;\n  this.downY = undefined;\n  this.upX = undefined;\n  this.upY = undefined;\n};\n\nwindow.onload = function () {\n  const resetBtn = document.getElementById('reset');\n  const playfield = document.getElementById('playfield');\n\n  const game = new Game();\n  const mouse = new Mouse();\n\n  game.reset();\n\n  document.addEventListener('keydown', function (e) {\n    switch (e.which) {\n      case 37: game.moveTiles('left'); break;\n      case 38: game.moveTiles('up'); break;\n      case 39: game.moveTiles('right'); break;\n      case 40: game.moveTiles('down'); break;\n      default: return;\n    }\n\n    game.render();\n  });\n\n  playfield.addEventListener('mousedown', function (e) {\n    mouse.onMouseDown(e);\n  });\n\n  playfield.addEventListener('touchstart', function (e) {\n    const touchEvent = e.touches[0];\n    mouse.onMouseDown(touchEvent);\n  });\n\n  playfield.addEventListener('mouseup', function (e) {\n    mouse.onMouseUp(e);\n    game.moveTiles(mouse.getDirection());\n    game.render();\n    mouse.reset();\n  });\n\n  playfield.addEventListener('touchend', function (e) {\n    const touchEvent = e.changedTouches[0];\n    mouse.onMouseUp(touchEvent);\n    game.moveTiles(mouse.getDirection());\n    game.render();\n  });\n\n  resetBtn.addEventListener('click', function () {\n    game.reset();\n  });\n};\n"]}